<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—å QUANTUM - –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .panel:hover {
            transform: translateY(-5px);
        }

        .panel h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .results {
            grid-column: 1 / -1;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .analytics-section {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .analytics-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .analytics-card h4 {
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 8px;
        }
        
        .analytics-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .analytics-table td {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .analytics-table td:first-child {
            color: #64748b;
            font-weight: 500;
        }
        
        .analytics-table td:last-child {
            text-align: right;
            font-weight: 600;
            color: #1e293b;
        }
        
        .analytics-table .highlight {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            font-weight: bold;
            border-radius: 6px;
            padding: 8px 12px;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }
        
        .chart-card h4 {
            color: #1e293b;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.1em;
        }
        
        .chart-card canvas {
            max-height: 300px;
        }

        .result-card h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .result-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .result-label {
            color: #718096;
            font-size: 0.9em;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .success {
            background: #c6f6d5;
            color: #2f855a;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .comparison-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: #e2e8f0;
            border: none;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            font-weight: 600;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .result-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ –ë–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—å QUANTUM</h1>
            <p>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –æ—Ç–µ–ª–µ–π –ö—É–±—ã</p>
        </div>

        <div class="main-content">
            <!-- –ü–∞–Ω–µ–ª—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
            <div class="panel">
                <h2>‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞</h2>
                
                <div class="form-group">
                    <label for="scenario">–°—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–∑–≤–∏—Ç–∏—è:</label>
                    <select id="scenario">
                        <option value="baseline">–ë–∞–∑–æ–≤—ã–π</option>
                        <option value="optimistic">–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π</option>
                        <option value="pessimistic">–ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–π</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="variant">–ú–æ–¥–µ–ª—å –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏:</label>
                    <select id="variant">
                        <option value="B">–ê—Ä–µ–Ω–¥–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (80/20)</option>
                        <option value="A">–ü—Ä–æ–¥–∞–∂–∞ + –ø–æ–¥–ø–∏—Å–∫–∞</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="hotels">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–µ–ª–µ–π:</label>
                    <input type="number" id="hotels" value="50" min="1" max="200">
                </div>

                <div class="form-group">
                    <label for="monthlyFee">–ê–±–æ–Ω–µ–Ω—Ç—Å–∫–∞—è –ø–ª–∞—Ç–∞ (USD/–º–µ—Å—è—Ü):</label>
                    <input type="number" id="monthlyFee" value="500" min="100" max="1000" step="50">
                </div>

                <div class="form-group">
                    <label for="equipmentCost">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (USD):</label>
                    <input type="number" id="equipmentCost" value="1154" min="500" max="3000" step="100">
                </div>

                <div class="form-group">
                    <label for="exchangeRate">–ö—É—Ä—Å —Ä—É–±–ª—å/–¥–æ–ª–ª–∞—Ä:</label>
                    <input type="number" id="exchangeRate" value="78" min="50" max="150" step="1">
                </div>

                <div class="form-group">
                    <label for="equipmentType">–¢–∏–ø –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è:</label>
                    <select id="equipmentType">
                        <option value="mini">Quantum GrandMaster Mini (–¢–µ—Ä–º–æ—Å—Ç–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–≤–∞—Ä—Ü)</option>
                        <option value="1u_2u">Quantum GrandMaster 1U/2U (–†—É–±–∏–¥–∏–µ–≤—ã–π/—Ü–µ–∑–∏–µ–≤—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="assemblyOption">–í–∞—Ä–∏–∞–Ω—Ç —Å–±–æ—Ä–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è:</label>
                    <select id="assemblyOption" onchange="updateAssemblyDescription()">
                        <option value="shiwa_assembled">–ì–æ—Ç–æ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –æ—Ç SHIWA</option>
                        <option value="etecsa_assembly">–°–±–æ—Ä–∫–∞ ETECSA –∏–∑ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏—Ö</option>
                        <option value="mixed_approach">–°–º–µ—à–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥</option>
                    </select>
                    <div id="assemblyDescription" class="form-description" style="font-size: 0.9em; color: #666; margin-top: 5px;">
                        SHIWA —Å–æ–±–∏—Ä–∞–µ—Ç –∏ –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
                    </div>
                </div>

                <div class="form-group">
                    <label for="assemblyVariant">–í–∞—Ä–∏–∞–Ω—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—Ö–æ–¥–æ–≤:</label>
                    <select id="assemblyVariant">
                        <option value="80_20">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (80% SHIWA / 20% ETECSA)</option>
                        <option value="50_50">–†–∞–≤–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (50% / 50%)</option>
                    </select>
                </div>

                <button class="btn" onclick="calculateResults()">üìä –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                <button class="btn" onclick="compareScenarios()" style="margin-top: 10px; background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">üîÑ –°—Ä–∞–≤–Ω–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏</button>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤ -->
            <div class="panel">
                <h2>üìà –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–Ω–∞–ª–∏–∑—ã</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="showTab('sensitivity')">–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</button>
                    <button class="tab" onclick="showTab('breakeven')">–ë–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å</button>
                    <button class="tab" onclick="showTab('charts')">–ì—Ä–∞—Ñ–∏–∫–∏</button>
                </div>

                <div id="sensitivity" class="tab-content active">
                    <div class="form-group">
                        <label for="sensitivityParam">–ü–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:</label>
                        <select id="sensitivityParam">
                            <option value="hotels_count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–µ–ª–µ–π</option>
                            <option value="monthly_fee">–ê–±–æ–Ω–µ–Ω—Ç—Å–∫–∞—è –ø–ª–∞—Ç–∞</option>
                            <option value="equipment_cost">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</option>
                        </select>
                    </div>
                    <button class="btn" onclick="sensitivityAnalysis()">üìä –ê–Ω–∞–ª–∏–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
                </div>

                <div id="breakeven" class="tab-content">
                    <button class="btn" onclick="breakevenAnalysis()">üìä –ê–Ω–∞–ª–∏–∑ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏</button>
                </div>

                <div id="charts" class="tab-content">
                    <button class="btn" onclick="generateCharts()">üìä –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏</button>
                </div>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div class="results">
            <div id="loading" class="loading" style="display: none;">
                ‚è≥ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–∞—Å—á–µ—Ç...
            </div>

            <div id="error" class="error" style="display: none;"></div>
            <div id="success" class="success" style="display: none;"></div>

            <div id="results" style="display: none;">
                <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>
                
                <div class="result-grid" id="resultGrid">
                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
                </div>

                <div class="chart-container">
                    <canvas id="resultsChart"></canvas>
                </div>

                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentResults = null;
        let charts = {};

        // –û–±–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Å–±–æ—Ä–∫–∏
        function updateAssemblyDescription() {
            const assemblyOption = document.getElementById('assemblyOption').value;
            const description = document.getElementById('assemblyDescription');
            
            const descriptions = {
                'shiwa_assembled': 'SHIWA —Å–æ–±–∏—Ä–∞–µ—Ç –∏ –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ',
                'etecsa_assembly': 'SHIWA –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ, ETECSA —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ',
                'mixed_approach': '–ß–∞—Å—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤–∞—è, —á–∞—Å—Ç—å —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ'
            };
            
            description.textContent = descriptions[assemblyOption] || '';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫–∏
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞—Å—á–µ—Ç
        async function calculateResults() {
            showLoading(true);
            hideMessages();

            try {
                const params = {
                    scenario: document.getElementById('scenario').value,
                    variant: document.getElementById('variant').value,
                    hotels_count: parseInt(document.getElementById('hotels').value),
                    monthly_fee: parseFloat(document.getElementById('monthlyFee').value),
                    equipment_cost: parseFloat(document.getElementById('equipmentCost').value),
                    exchange_rate: parseFloat(document.getElementById('exchangeRate').value),
                    equipment_type: document.getElementById('equipmentType').value,
                    assembly_option: document.getElementById('assemblyOption').value,
                    assembly_variant: document.getElementById('assemblyVariant').value
                };

                const response = await fetch('/api/calculate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(params)
                });

                const result = await response.json();

                if (result.success) {
                    currentResults = result.data;
                    displayResults(result.data);
                    showSuccess('–†–∞—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                } else {
                    showError('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞: ' + result.error);
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
            }

            showLoading(false);
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function displayResults(data) {
            const summary = data.summary;
            const grid = document.getElementById('resultGrid');
            
            grid.innerHTML = `
                <div class="result-card">
                    <h3>–û–ë–û–†–£–î–û–í–ê–ù–ò–ï</h3>
                    <div class="result-value">${summary.equipment_name}</div>
                    <div class="result-label">${summary.assembly_name}</div>
                </div>
                <div class="result-card">
                    <h3>SHIWA NETWORK</h3>
                    <div class="result-value">$${summary.shiwa.total_revenue.toLocaleString()}</div>
                    <div class="result-label">–û–±—â–∏–π –¥–æ—Ö–æ–¥</div>
                </div>
                <div class="result-card">
                    <h3>SHIWA NETWORK</h3>
                    <div class="result-value">$${summary.shiwa.net_profit.toLocaleString()}</div>
                    <div class="result-label">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</div>
                </div>
                <div class="result-card">
                    <h3>SHIWA NETWORK</h3>
                    <div class="result-value">${summary.shiwa.roi.toFixed(1)}%</div>
                    <div class="result-label">ROI</div>
                </div>
                <div class="result-card">
                    <h3>ETECSA</h3>
                    <div class="result-value">$${summary.etecsa.net_profit.toLocaleString()}</div>
                    <div class="result-label">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</div>
                </div>
                <div class="result-card">
                    <h3>–û–¢–ï–õ–ò</h3>
                    <div class="result-value">$${summary.hotels.total_benefit.toLocaleString()}</div>
                    <div class="result-label">–ì–æ–¥–æ–≤–∞—è —ç–∫–æ–Ω–æ–º–∏—è</div>
                </div>
                <div class="result-card">
                    <h3>–û–ö–£–ü–ê–ï–ú–û–°–¢–¨</h3>
                    <div class="result-value">${data.payback ? data.payback.payback_months.toFixed(1) : 'N/A'}</div>
                    <div class="result-label">–º–µ—Å—è—Ü–µ–≤</div>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É
            addDetailedAnalytics(data);

            document.getElementById('results').style.display = 'block';
            
            // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            createResultsChart(data);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        function addDetailedAnalytics(data) {
            const summary = data.summary;
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            let analyticsContainer = document.getElementById('analyticsContainer');
            if (!analyticsContainer) {
                analyticsContainer = document.createElement('div');
                analyticsContainer.id = 'analyticsContainer';
                analyticsContainer.className = 'analytics-section';
                document.getElementById('results').appendChild(analyticsContainer);
            }
            
            analyticsContainer.innerHTML = `
                <h3>üìä –î–µ—Ç–∞–ª—å–Ω–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h4>SHIWA NETWORK</h4>
                        <table class="analytics-table">
                            <tr><td>–î–æ—Ö–æ–¥ –æ—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è:</td><td>$${summary.shiwa.equipment_revenue.toLocaleString()}</td></tr>
                            <tr><td>–î–æ—Ö–æ–¥ –æ—Ç –ø–æ–¥–ø–∏—Å–∫–∏:</td><td>$${summary.shiwa.subscription_revenue.toLocaleString()}</td></tr>
                            <tr><td>–û–±—â–∏–π –¥–æ—Ö–æ–¥:</td><td>$${summary.shiwa.total_revenue.toLocaleString()}</td></tr>
                            <tr><td>–û–±—â–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã:</td><td>$${summary.shiwa.total_costs.toLocaleString()}</td></tr>
                            <tr><td class="highlight">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å:</td><td class="highlight">$${summary.shiwa.net_profit.toLocaleString()}</td></tr>
                            <tr><td>ROI:</td><td>${summary.shiwa.roi.toFixed(1)}%</td></tr>
                        </table>
                    </div>
                    
                    <div class="analytics-card">
                        <h4>ETECSA</h4>
                        <table class="analytics-table">
                            <tr><td>–î–æ—Ö–æ–¥ –æ—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è:</td><td>$${summary.etecsa.equipment_profit.toLocaleString()}</td></tr>
                            <tr><td>–î–æ—Ö–æ–¥ –æ—Ç –ø–æ–¥–ø–∏—Å–∫–∏:</td><td>$${summary.etecsa.subscription_revenue.toLocaleString()}</td></tr>
                            <tr><td>–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã:</td><td>$${summary.etecsa.operational_costs.toLocaleString()}</td></tr>
                            <tr><td class="highlight">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å:</td><td class="highlight">$${summary.etecsa.net_profit.toLocaleString()}</td></tr>
                        </table>
                    </div>
                    
                    <div class="analytics-card">
                        <h4>–û–¢–ï–õ–ò</h4>
                        <table class="analytics-table">
                            <tr><td>–ì–æ–¥–æ–≤—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã:</td><td>$${summary.hotels.annual_cost.toLocaleString()}</td></tr>
                            <tr><td>–≠–∫–æ–Ω–æ–º–∏—è –æ—Ç –±–∏–ª–ª–∏–Ω–≥–∞:</td><td>$${summary.hotels.billing_savings.toLocaleString()}</td></tr>
                            <tr><td>–≠–∫–æ–Ω–æ–º–∏—è –æ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</td><td>$${summary.hotels.efficiency_savings.toLocaleString()}</td></tr>
                            <tr><td>–≠–∫–æ–Ω–æ–º–∏—è –æ—Ç –ø—Ä–æ—Å—Ç–æ—è:</td><td>$${summary.hotels.downtime_savings.toLocaleString()}</td></tr>
                            <tr><td class="highlight">–û–±—â–∞—è —ç–∫–æ–Ω–æ–º–∏—è:</td><td class="highlight">$${summary.hotels.total_benefit.toLocaleString()}</td></tr>
                            <tr><td>ROI:</td><td>${summary.hotels.roi.toFixed(1)}%</td></tr>
                        </table>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <h4>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤</h4>
                        <canvas id="revenueChart" width="400" height="200"></canvas>
                    </div>
                    <div class="chart-card">
                        <h4>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏</h4>
                        <canvas id="profitChart" width="400" height="200"></canvas>
                    </div>
                    <div class="chart-card">
                        <h4>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ SHIWA</h4>
                        <canvas id="shiwaRevenueChart" width="400" height="200"></canvas>
                    </div>
                    <div class="chart-card">
                        <h4>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ ETECSA</h4>
                        <canvas id="etecsaRevenueChart" width="400" height="200"></canvas>
                    </div>
                </div>
            `;
            
            // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
            createAnalyticsCharts(summary);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        function createAnalyticsCharts(summary) {
            // –ì—Ä–∞—Ñ–∏–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–æ—Ö–æ–¥–æ–≤
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            new Chart(revenueCtx, {
                type: 'bar',
                data: {
                    labels: ['SHIWA NETWORK', 'ETECSA'],
                    datasets: [{
                        label: '–û–±—â–∏–π –¥–æ—Ö–æ–¥',
                        data: [summary.shiwa.total_revenue, summary.etecsa.equipment_profit + summary.etecsa.subscription_revenue],
                        backgroundColor: ['#4F46E5', '#059669'],
                        borderColor: ['#3730A3', '#047857'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // –ì—Ä–∞—Ñ–∏–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø—Ä–∏–±—ã–ª–∏
            const profitCtx = document.getElementById('profitChart').getContext('2d');
            new Chart(profitCtx, {
                type: 'bar',
                data: {
                    labels: ['SHIWA NETWORK', 'ETECSA'],
                    datasets: [{
                        label: '–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å',
                        data: [summary.shiwa.net_profit, summary.etecsa.net_profit],
                        backgroundColor: ['#7C3AED', '#DC2626'],
                        borderColor: ['#5B21B6', '#B91C1C'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—Ö–æ–¥–æ–≤ SHIWA
            const shiwaRevenueCtx = document.getElementById('shiwaRevenueChart').getContext('2d');
            new Chart(shiwaRevenueCtx, {
                type: 'doughnut',
                data: {
                    labels: ['–î–æ—Ö–æ–¥ –æ—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', '–î–æ—Ö–æ–¥ –æ—Ç –ø–æ–¥–ø–∏—Å–∫–∏'],
                    datasets: [{
                        data: [summary.shiwa.equipment_revenue, summary.shiwa.subscription_revenue],
                        backgroundColor: ['#4F46E5', '#8B5CF6'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = '$' + context.parsed.toLocaleString();
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return label + ': ' + value + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });

            // –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—Ö–æ–¥–æ–≤ ETECSA
            const etecsaRevenueCtx = document.getElementById('etecsaRevenueChart').getContext('2d');
            new Chart(etecsaRevenueCtx, {
                type: 'doughnut',
                data: {
                    labels: ['–î–æ—Ö–æ–¥ –æ—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', '–î–æ—Ö–æ–¥ –æ—Ç –ø–æ–¥–ø–∏—Å–∫–∏'],
                    datasets: [{
                        data: [summary.etecsa.equipment_profit, summary.etecsa.subscription_revenue],
                        backgroundColor: ['#059669', '#10B981'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = '$' + context.parsed.toLocaleString();
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return label + ': ' + value + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function createResultsChart(data) {
            const ctx = document.getElementById('resultsChart').getContext('2d');
            
            if (charts.results) {
                charts.results.destroy();
            }

            const summary = data.summary;
            
            charts.results = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['SHIWA –î–æ—Ö–æ–¥', 'SHIWA –ü—Ä–∏–±—ã–ª—å', 'ETECSA –ü—Ä–∏–±—ã–ª—å', '–û—Ç–µ–ª–∏ ROI'],
                    datasets: [{
                        label: '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏',
                        data: [
                            summary.shiwa.total_revenue,
                            summary.shiwa.net_profit,
                            summary.etecsa.net_profit,
                            summary.hotels.roi * 1000 // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏
                        ],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(72, 187, 120, 0.8)',
                            'rgba(237, 137, 54, 0.8)'
                        ],
                        borderColor: [
                            'rgba(102, 126, 234, 1)',
                            'rgba(118, 75, 162, 1)',
                            'rgba(72, 187, 120, 1)',
                            'rgba(237, 137, 54, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // –ê–Ω–∞–ª–∏–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        async function sensitivityAnalysis() {
            showLoading(true);
            hideMessages();

            try {
                const param = document.getElementById('sensitivityParam').value;
                let values = [];
                
                if (param === 'hotels_count') {
                    values = [25, 35, 50, 65, 75, 100];
                } else if (param === 'monthly_fee') {
                    values = [300, 400, 500, 600, 700, 800];
                } else if (param === 'equipment_cost') {
                    values = [800, 1000, 1154, 1300, 1500, 1800];
                }

                const response = await fetch('/api/sensitivity', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        parameter: param,
                        values: values,
                        scenario: document.getElementById('scenario').value,
                        variant: document.getElementById('variant').value
                    })
                });

                const result = await response.json();

                if (result.success) {
                    createSensitivityChart(result.data);
                    showSuccess('–ê–Ω–∞–ª–∏–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω!');
                } else {
                    showError('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: ' + result.error);
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
            }

            showLoading(false);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        function createSensitivityChart(data) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            if (charts.comparison) {
                charts.comparison.destroy();
            }

            const labels = data.results.map(r => r.value.toString());
            const profits = data.results.map(r => r.shiwa_profit);
            const rois = data.results.map(r => r.shiwa_roi);

            charts.comparison = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–ü—Ä–∏–±—ã–ª—å SHIWA (USD)',
                        data: profits,
                        borderColor: 'rgba(102, 126, 234, 1)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        yAxisID: 'y'
                    }, {
                        label: 'ROI SHIWA (%)',
                        data: rois,
                        borderColor: 'rgba(118, 75, 162, 1)',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: `–ê–Ω–∞–ª–∏–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: ${data.parameter}`
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: '–ü—Ä–∏–±—ã–ª—å (USD)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'ROI (%)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // –ê–Ω–∞–ª–∏–∑ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏
        async function breakevenAnalysis() {
            showLoading(true);
            hideMessages();

            try {
                const response = await fetch('/api/breakeven');
                const result = await response.json();

                if (result.success) {
                    const data = result.data;
                    showSuccess(`SHIWA: ${data.shiwa.breakeven_hotels.toFixed(1)} –æ—Ç–µ–ª–µ–π, ETECSA: ${data.etecsa.breakeven_hotels.toFixed(1)} –æ—Ç–µ–ª–µ–π`);
                } else {
                    showError('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: ' + result.error);
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
            }

            showLoading(false);
        }

        // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
        async function compareScenarios() {
            showLoading(true);
            hideMessages();

            try {
                const scenarios = [
                    { scenario: 'baseline', variant: 'B' },
                    { scenario: 'optimistic', variant: 'B' },
                    { scenario: 'pessimistic', variant: 'B' }
                ];

                const response = await fetch('/api/compare', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ scenarios: scenarios })
                });

                const result = await response.json();

                if (result.success) {
                    createComparisonChart(result.data);
                    showSuccess('–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!');
                } else {
                    showError('–û—à–∏–±–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è: ' + result.error);
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
            }

            showLoading(false);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        function createComparisonChart(data) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            if (charts.comparison) {
                charts.comparison.destroy();
            }

            const labels = data.map(d => `${d.scenario} (${d.variant})`);
            const profits = data.map(d => d.summary.shiwa.net_profit);
            const revenues = data.map(d => d.summary.shiwa.total_revenue);

            charts.comparison = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–ü—Ä–∏–±—ã–ª—å SHIWA (USD)',
                        data: profits,
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2
                    }, {
                        label: '–î–æ—Ö–æ–¥ SHIWA (USD)',
                        data: revenues,
                        backgroundColor: 'rgba(118, 75, 162, 0.8)',
                        borderColor: 'rgba(118, 75, 162, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ä–∞–∑–≤–∏—Ç–∏—è'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        function generateCharts() {
            if (currentResults) {
                createResultsChart(currentResults);
                showSuccess('–ì—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
            } else {
                showError('–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä–∞—Å—á–µ—Ç!');
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => errorDiv.style.display = 'none', 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => successDiv.style.display = 'none', 3000);
        }

        function hideMessages() {
            document.getElementById('error').style.display = 'none';
            document.getElementById('success').style.display = 'none';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            calculateResults();
        });
    </script>
</body>
</html>
